{% extends 'main.html' %}
{% load static %}

{% block content %}

<div class="i-product-container">
  <div class="i-image-gallery">
    <div class="i-main-image-container">
      <img src="{{ product.first_image }}" class="i-main-image" id="mainImage">
    </div>
    <div class="i-thumbs">
      {% for img in product_imgs %}
      <img src="{{ img.image.url }}" onclick="changeImage(this)" alt="{{ img.product.name }}">
      {% endfor %}
    </div>
  </div>

  <div class="i-product-details">
    <h1>{{product.name}}</h1>

    <!-- Price -->
    <div class="i-price-box">
      <span class="i-new-price">Rs {{product.price}}</span>
      {% if product.discount_percent != 0.00 %}
      <span class="i-old-price">Rs {{product.old_price}}</span>
      <span class="i-discount">{{ product.discount_percent }}% OFF</span>
      {% endif %}
    </div>

    <!-- Added date & rating -->
    <div class="i-added-date">Added: {{product.created_at|timesince}} ago</div>
    <div class="i-rating">‚≠ê 4.5/5 (120 reviews)</div>

    <div class="i-seller-box">
      <a href="{% url 'seller-account' store.user.id %}" style="margin: 0;"><img src="{{ store.store_logo.url }}"
          alt="Seller" class="i-seller-img"></a>
      <div class="i-seller-info">
        <a href="{% url 'seller-account' store.user.id %}" style="margin: 0;"><span
            class="i-store-name">{{store.store_name}}</span></a><br>
      </div>
    </div>

    <div class="i-actions">
      <button class="i-wishlist">‚ô° Add to Wishlist</button>
      <button class="i-share" onclick="openShare()">üîó Share</button>
    </div>

    <div id="shareModal" class="i-share-modal">
      <div class="i-share-content">
        <span class="i-close" onclick="closeShare()">&times;</span>

        <div class="i-url-box">
          <input type="text" id="shareUrl" readonly>
          <button onclick="copyUrl()">Copy</button>
        </div>

        <div id="qrCode" class="i-qr-box"></div>
      </div>
    </div>

    <div class="i-quantity-cart">
      <input type="number" value="1" min="1">
      <button class="i-add-to-cart">Add to Cart</button>
    </div>
  </div>
</div>

<div class="i-specs">
  <h2>Specifications</h2>
  <table>
    {% for key, value in product.description.items %}
    <tr>
      <th>{{key}}</th>
      <td>{{value}}</td>
    </tr>
    {% endfor %}
  </table>
</div>

<div class="i-qa-reviews">
  <div class="i-qa-section">
    <h2>Product Questions</h2>
    <form action="" method="POST">
      {% csrf_token %}
      <input name="question" type="text" id="questionInput" placeholder="Ask a question...">
      <button type="submit">Submit</button>
    </form>
    <div class="i-question-list" id="questionList">
      {% for question in questions %}
      <div class="i-question">
        {{question.user.first_name}}: {{question.question}} <span class="i-date">{{question.created_at|timesince}}</span>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="i-review-section">
    <h2>Customer Reviews</h2>
    <div class="i-review-list">
      <div class="i-review">
        <div class="i-review-rating">‚≠ê 4.5/5</div>
        <p>Aayush: Great shoes, very comfortable!</p>
        <span class="i-date">Aug 13, 2025</span>
      </div>
      <div class="i-review">
        <div class="i-review-rating">‚≠ê 4.5/5</div>
        <p>Aayush: Great shoes, very comfortable!</p>
        <span class="i-date">Aug 13, 2025</span>
      </div>
    </div>
  </div>
</div>

<br><br><br>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script>
  function changeImage(img) {
    document.getElementById("mainImage").src = img.src;
  }

  function openShare() {
    let modal = document.getElementById("shareModal");
    let shareUrl = document.getElementById("shareUrl");
    let qrBox = document.getElementById("qrCode");

    // Get current page URL
    let url = window.location.href;
    shareUrl.value = url;

    qrBox.innerHTML = "";

    new QRCode(qrBox, {
      text: url,
      width: 200,
      height: 200
    });

    modal.style.display = "flex";
  }

  function closeShare() {
    document.getElementById("shareModal").style.display = "none";
  }

  function copyUrl() {
    let copyText = document.getElementById("shareUrl");
    copyText.select();
    copyText.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(copyText.value);
    alert("URL copied to clipboard!");
  }

  // Close when clicking outside modal
  window.onclick = function (event) {
    let modal = document.getElementById("shareModal");
    if (event.target === modal) {
      modal.style.display = "none";
    }
  }
</script>

{% endblock %}